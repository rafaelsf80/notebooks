<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Federated Learning: ejemplo sencillo | Blog práctico de Aprendizaje Profundo en Español</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Federated Learning: ejemplo sencillo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ejemplo sencillo de Federated Learning con TFF usando MNIST." />
<meta property="og:description" content="Ejemplo sencillo de Federated Learning con TFF usando MNIST." />
<link rel="canonical" href="https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html" />
<meta property="og:url" content="https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html" />
<meta property="og:site_name" content="Blog práctico de Aprendizaje Profundo en Español" />
<meta property="og:image" content="https://rafaelsf80.github.io/notebooks/images/tensorflow.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-16T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Federated Learning: ejemplo sencillo","dateModified":"2021-01-16T00:00:00-06:00","datePublished":"2021-01-16T00:00:00-06:00","description":"Ejemplo sencillo de Federated Learning con TFF usando MNIST.","mainEntityOfPage":{"@type":"WebPage","@id":"https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html"},"image":"https://rafaelsf80.github.io/notebooks/images/tensorflow.png","@type":"BlogPosting","url":"https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/notebooks/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://rafaelsf80.github.io/notebooks/feed.xml" title="Blog práctico de Aprendizaje Profundo en Español" /><link rel="shortcut icon" type="image/x-icon" href="/notebooks/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Federated Learning: ejemplo sencillo | Blog práctico de Aprendizaje Profundo en Español</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Federated Learning: ejemplo sencillo" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ejemplo sencillo de Federated Learning con TFF usando MNIST." />
<meta property="og:description" content="Ejemplo sencillo de Federated Learning con TFF usando MNIST." />
<link rel="canonical" href="https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html" />
<meta property="og:url" content="https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html" />
<meta property="og:site_name" content="Blog práctico de Aprendizaje Profundo en Español" />
<meta property="og:image" content="https://rafaelsf80.github.io/notebooks/images/tensorflow.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-01-16T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"Federated Learning: ejemplo sencillo","dateModified":"2021-01-16T00:00:00-06:00","datePublished":"2021-01-16T00:00:00-06:00","description":"Ejemplo sencillo de Federated Learning con TFF usando MNIST.","mainEntityOfPage":{"@type":"WebPage","@id":"https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html"},"image":"https://rafaelsf80.github.io/notebooks/images/tensorflow.png","@type":"BlogPosting","url":"https://rafaelsf80.github.io/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://rafaelsf80.github.io/notebooks/feed.xml" title="Blog práctico de Aprendizaje Profundo en Español" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/notebooks/">Blog práctico de Aprendizaje Profundo en Español</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/notebooks/about/">About Me</a><a class="page-link" href="/notebooks/search/">Search</a><a class="page-link" href="/notebooks/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Federated Learning: ejemplo sencillo</h1><p class="page-description">Ejemplo sencillo de Federated Learning con TFF usando MNIST.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-01-16T00:00:00-06:00" itemprop="datePublished">
        Jan 16, 2021
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/notebooks/categories/#Computer Vision">Computer Vision</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/rafaelsf80/notebooks/tree/master/_notebooks/2021-01-16-tensorflow-federated.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/notebooks/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/rafaelsf80/notebooks/master?filepath=_notebooks%2F2021-01-16-tensorflow-federated.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notebooks/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/rafaelsf80/notebooks/blob/master/_notebooks/2021-01-16-tensorflow-federated.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/notebooks/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#1.-Introducción">1. Introducción </a></li>
<li class="toc-entry toc-h2"><a href="#2.-Setup">2. Setup </a></li>
<li class="toc-entry toc-h2"><a href="#3.-Carga-de-datos">3. Carga de datos </a></li>
<li class="toc-entry toc-h2"><a href="#4.-Construcción-del-modelo">4. Construcción del modelo </a></li>
<li class="toc-entry toc-h2"><a href="#5.-Simulación-y-evaluación">5. Simulación y evaluación </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-01-16-tensorflow-federated.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Introducción">
<a class="anchor" href="#1.-Introducci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. Introducción<a class="anchor-link" href="#1.-Introducci%C3%B3n"> </a>
</h2>
<p>Este tutorial usa el dataset de MNIST con el API de alto nivel de TFF, llamado <strong>FL API</strong> (Federated Layer API) cuya clase principal es  <code>tff.learning</code>, la cual incluye interfaces de alto nivel para tareas típicas de federación como entrenamiento y otras.</p>
<p>Existe otra API de más bajo nivel, <strong>FC API</strong> (Federated Core API), que permite implementar tus propios algoritmos de federación.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Setup">
<a class="anchor" href="#2.-Setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. Setup<a class="anchor-link" href="#2.-Setup"> </a>
</h2>
<p>Instalamos versiones concretas de TF y TFF, que deben ser compatibles entre ellas. Ver <a href="https://github.com/tensorflow/federated#compatibility">tabla</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>pip install --quiet --upgrade <span class="nv">tensorflow_federated</span><span class="o">==</span><span class="m">0</span>.17
<span class="o">!</span>pip install --quiet --upgrade <span class="nv">tensorflow</span><span class="o">==</span><span class="m">2</span>.3.0

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_federated</span> <span class="k">as</span> <span class="nn">tff</span>

<span class="nb">print</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">tff</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>La instalación del paquete <code>nest_asyncio</code> evita errores de ejecución en los protocolos de federación en Jupyter (del tipo <em>"can not join a run while another loop is running"</em>):</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">nest_asyncio</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3.-Carga-de-datos">
<a class="anchor" href="#3.-Carga-de-datos" aria-hidden="true"><span class="octicon octicon-link"></span></a>3. Carga de datos<a class="anchor-link" href="#3.-Carga-de-datos"> </a>
</h2>
<p>Cargamos los datos. TFF ya tiene una clase para cargar datos y poder separarla en clientes.
El dataset que devuelve <code>load_data()</code> son instancias de <code>tff.simulation.ClientData</code>, un interfaz que permite escoger un conjunto de clientes, para posteriormente construir un <code>tf.data.Dataset</code> que represente los datos de un cliente, y así poder entrenar.</p>
<p>Nótese que este interfaz permite iterar sobre ID de clientes, pero en este tutorial sólo los estamos simulando. Los ID de clientes no se usan en el algoritmo de federación, sólo se usan para escoger los datos de cada cliente.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Load simulation data.</span>
<span class="n">source</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">tff</span><span class="o">.</span><span class="n">simulation</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">emnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">client_data</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">source</span><span class="o">.</span><span class="n">create_tf_dataset_for_client</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">client_ids</span><span class="p">[</span><span class="n">n</span><span class="p">])</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
      <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="s1">'pixels'</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">e</span><span class="p">[</span><span class="s1">'label'</span><span class="p">])</span>
  <span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">client_ids</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Seleccionamos unos cuantos clientes que participarán en el entrenamiento:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Pick a subset of client devices to participate in training.</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">client_data</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<span class="n">source</span><span class="o">.</span><span class="n">element_type_structure</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4.-Construcción-del-modelo">
<a class="anchor" href="#4.-Construcci%C3%B3n-del-modelo" aria-hidden="true"><span class="octicon octicon-link"></span></a>4. Construcción del modelo<a class="anchor-link" href="#4.-Construcci%C3%B3n-del-modelo"> </a>
</h2>
<p>Usamos un modelo estándar de Keras, el cual debe paquetizarse dentro de la clase <code>tff.learning</code>.
Se usará la llamada <code>tff.learning.from_keras_model</code>, pasándole el modelo Keras original y los datos.</p>
<p><strong>Nota:</strong> no hay que compilar ahora. Las métricas, pérdidas y optimizadores se configuran más tarde.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Wrap a Keras model for use with TFF.</span>
<span class="k">def</span> <span class="nf">model_fn</span><span class="p">():</span>
  <span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
      <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">784</span><span class="p">,),</span>
                            <span class="n">kernel_initializer</span><span class="o">=</span><span class="s1">'zeros'</span><span class="p">)</span>
  <span class="p">])</span>
  <span class="k">return</span> <span class="n">tff</span><span class="o">.</span><span class="n">learning</span><span class="o">.</span><span class="n">from_keras_model</span><span class="p">(</span>
      <span class="n">model</span><span class="p">,</span>
      <span class="n">input_spec</span><span class="o">=</span><span class="n">train_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">element_spec</span><span class="p">,</span>
      <span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">SparseCategoricalCrossentropy</span><span class="p">(),</span>
      <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">SparseCategoricalAccuracy</span><span class="p">()])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5.-Simulación-y-evaluación">
<a class="anchor" href="#5.-Simulaci%C3%B3n-y-evaluaci%C3%B3n" aria-hidden="true"><span class="octicon octicon-link"></span></a>5. Simulación y evaluación<a class="anchor-link" href="#5.-Simulaci%C3%B3n-y-evaluaci%C3%B3n"> </a>
</h2>
<p>Ahora que tenemos el modelo empaquetado en una clase <code>tff.learning.Model</code> para usarlo en TFF, podemos ejecutar
al algoritmo <strong>Federated Averaging</strong> usando la función <code>tff.learning.build_federated_averaging_process</code>.</p>
<p>El argumento debe ser un constructor (como la <code>model_fn</code> de arriba), no una instancia, para que la construcción y compilado del modelo
lo pueda implementar TFF. Los detalles técnicos están en <a href="custom_federated_algorithms_1.ipynb">este tutorial</a>.</p>
<p>El algoritmo <strong>Federated Averaging</strong> tiene dos optimizadores:</p>
<ol>
<li>
<code>_client_optimizer_</code>: se usa para computar updates en cada cliente.  </li>
<li>
<code>_server_optimizer_</code>: aplica la media al modelo global en el servidor.</li>
</ol>
<p>Por tanto, la elección de los hiperparámeotrs de optimizador y learning rate serán distintos que los que se usan en el modelo Keras original de MNIST. Se recomienda empezar con SGD, con un learning rate pequeño.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Simulate a few rounds of training with the selected client devices.</span>
<span class="n">trainer</span> <span class="o">=</span> <span class="n">tff</span><span class="o">.</span><span class="n">learning</span><span class="o">.</span><span class="n">build_federated_averaging_process</span><span class="p">(</span>
  <span class="n">model_fn</span><span class="p">,</span>
  <span class="n">client_optimizer_fn</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TFF implementa el algoritmo de <a href="https://arxiv.org/abs/1602.05629">Federated Averaging</a> con dos computaciones empaquetadas en la clase <code>tff.templates.IterativeProcess</code>. Estas dos computaciones son <code>initialize</code> y <code>next</code>.</p>
<ol>
<li>La operación <code>initialize</code> es una función, como todas las computaciones federadas.
No usa argumentos, y devuelve un resultado: la representación del estado del proceso de Federated Averaging en el servidor.</li>
<li>La operación <code>next</code> es una función, y representa un ciclo completo de Federated Averaging, que consiste en desplegar el estado del servidor (incluyendo el modelo inicial) a los clientes, entrenamiento en los clientes, recogida de parámetros de vuelta, y generación de un modelo nuevo en el servidor.</li>
</ol>
<p>Actualmente el algoritmo se soporta en local por ahora (se ejecuta toda en una máquina).</p>
<p>Se puede pensar en <code>next</code> como este flujo:</p>
<p><code>SERVER_STATE, FEDERATED_DATA -&gt; SERVER_STATE, TRAINING_METRICS</code></p>
<p>Es decir, <code>next</code> no es una función que se ejecuta en un servidor, sino que se ejecuta de manera distribuída, con un input del servidor (<code>SERVER_STATE</code>), y unas contribuciones de cada cliente con sus propios datos locales.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
  <span class="n">state</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="n">trainer</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">'train'</span><span class="p">][</span><span class="s1">'loss'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>En este tutorial, se deberían escoger clientes aleatoriamente, pero reusamos los clientes para una covergencia más rápida. Las pérdidas deberían disminuir después de cada ciclo de entrenamiento federado, mostrando que el modelo converge.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="rafaelsf80/notebooks"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/notebooks/computer%20vision/2021/01/16/tensorflow-federated.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/notebooks/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/notebooks/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/notebooks/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Una lista de posts y notebooks prácticos en español sobre inteligencia artificial y aprendizaje profundo.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/rafaelsf80" target="_blank" title="rafaelsf80"><svg class="svg-icon grey"><use xlink:href="/notebooks/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/rafaelsf80" target="_blank" title="rafaelsf80"><svg class="svg-icon grey"><use xlink:href="/notebooks/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
