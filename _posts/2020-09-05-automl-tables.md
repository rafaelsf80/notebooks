---
keywords: fastai
description: "(SPANISH) Entrenamiento e inferencia con Google Cloud AutoML Tables"
title: "AutoML tables asdfasdfkahdfkhaskdfhasd. asdfasdfkjhagsdfasdhfgjasd"
toc: true 
badges: true 
comments: true
categories: ["Structured Data", "Google Cloud"]
image: images/vertex.png
nb_path: _notebooks/2020-09-05-automl-tables.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-09-05-automl-tables.ipynb
-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1.-Project-set-up">1. Project set up<a class="anchor-link" href="#1.-Project-set-up"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Follow the <a href="https://cloud.google.com/automl-tables/docs/">AutoML Tables documentation</a> to</p>
<ul>
<li>Create a Google Cloud Platform (GCP) project.</li>
<li>Enable billing.</li>
<li>Apply to whitelist your project.</li>
<li>Enable AutoML API.</li>
<li>Enable AutoML Talbes API.</li>
<li>Create a service account, grant required permissions, and download the service account private key.</li>
</ul>
<p>You also need to upload your data into Google Cloud Storage (GCS) or BigQuery. For example, to use GCS as your data source</p>
<ul>
<li>Create a GCS bucket.</li>
<li>Upload the training and batch prediction files.</li>
</ul>
<p><strong>Warning:</strong> Private keys must be kept secret. If you expose your private key it is recommended to revoke it immediately from the Google Cloud Console.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2.-Initialize-and-authenticate">2. Initialize and authenticate<a class="anchor-link" href="#2.-Initialize-and-authenticate"> </a></h2><p>This section runs intialization and authentication. It creates an authenticated session which is required for running any of the following sections.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Install-the-client-library">Install the client library<a class="anchor-link" href="#Install-the-client-library"> </a></h3><p>Run the following cell. Click on the 'Choose Files' button and select the client library compressed file. The file is uploaded to your Colab and installed using <code>pip</code>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Install AutoML Tables client library { vertical-output: true }</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">files</span>
<span class="kn">import</span> <span class="nn">tarfile</span>

<span class="c1"># Upload the client library</span>
<span class="n">compressed_file_upload</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
<span class="n">compressed_file_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">compressed_file_upload</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Decompress the client library</span>
<span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">compressed_file_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
  <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="c1"># Install the client library</span>
<span class="o">!</span>pip install ./python/automl-v1beta1
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Authenticate-using-service-account-key">Authenticate using service account key<a class="anchor-link" href="#Authenticate-using-service-account-key"> </a></h3><p>Run the following cell. Click on the 'Choose Files' button and select the service account private key file. If your Service Account key file or folder is hidden, you can reveal it in a Mac by pressing the <b>Command + Shift + .</b> combo.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Authenticate using service account key and create a client. { vertical-output: true }</span>

<span class="kn">from</span> <span class="nn">google.cloud</span> <span class="kn">import</span> <span class="n">automl_v1beta1</span>

<span class="c1"># Upload service account key</span>
<span class="n">keyfile_upload</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">upload</span><span class="p">()</span>
<span class="n">keyfile_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">keyfile_upload</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Authenticate and create an AutoML client.</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">automl_v1beta1</span><span class="o">.</span><span class="n">AutoMlClient</span><span class="o">.</span><span class="n">from_service_account_file</span><span class="p">(</span><span class="n">keyfile_name</span><span class="p">)</span>
<span class="c1"># Authenticate and create a prediction service client.</span>
<span class="n">prediction_client</span> <span class="o">=</span> <span class="n">automl_v1beta1</span><span class="o">.</span><span class="n">PredictionServiceClient</span><span class="o">.</span><span class="n">from_service_account_file</span><span class="p">(</span><span class="n">keyfile_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Test">Test<a class="anchor-link" href="#Test"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Enter your GCP project ID.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title GCP project ID and location</span>

<span class="n">project_id</span> <span class="o">=</span> <span class="s1">&#39;&lt;PROJECT_ID&gt;&#39;</span> <span class="c1">#@param {type:&#39;string&#39;}</span>
<span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;us-central1&#39;</span>
<span class="n">location_path</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">location_path</span><span class="p">(</span><span class="n">project_id</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
<span class="n">location_path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To test whether your project set up and authentication steps were successful, run the following cell to list your datasets.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title List datasets. { vertical-output: true }</span>

<span class="n">list_datasets_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_datasets</span><span class="p">(</span><span class="n">location_path</span><span class="p">)</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">{</span><span class="n">dataset</span><span class="o">.</span><span class="n">display_name</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="n">list_datasets_response</span><span class="p">}</span>
<span class="n">datasets</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also print the list of your models by running the following cell.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title List models. { vertical-output: true }</span>

<span class="n">list_models_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_models</span><span class="p">(</span><span class="n">location_path</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span><span class="n">model</span><span class="o">.</span><span class="n">display_name</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">list_models_response</span><span class="p">}</span>
<span class="n">models</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3.-Import-training-data">3. Import training data<a class="anchor-link" href="#3.-Import-training-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Create-dataset">Create dataset<a class="anchor-link" href="#Create-dataset"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Select a dataset display name and pass your table source information to create a new dataset.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Create dataset { vertical-output: true, output-height: 200 }</span>

<span class="n">dataset_display_name</span> <span class="o">=</span> <span class="s1">&#39;iris_dataset&#39;</span> <span class="c1">#@param {type: &#39;string&#39;}</span>

<span class="n">create_dataset_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span>
    <span class="n">location_path</span><span class="p">,</span>
    <span class="p">{</span><span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="n">dataset_display_name</span><span class="p">,</span> <span class="s1">&#39;tables_dataset_metadata&#39;</span><span class="p">:</span> <span class="p">{}})</span>
<span class="n">dataset_name</span> <span class="o">=</span> <span class="n">create_dataset_response</span><span class="o">.</span><span class="n">name</span>
<span class="n">create_dataset_response</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Import-data">Import data<a class="anchor-link" href="#Import-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can import your data to AutoML Tables from GCS or BigQuery. For this tutorial, you can use the <a href="https://storage.cloud.google.com/rostam-193618-tutorial/automl-tables-v1beta1/iris.csv">iris dataset</a> as your training data. You can create a GCS bucket and upload the  data into your bucket. The URI for your file is <code>gs://BUCKET_NAME/FOLDER_NAME1/FOLDER_NAME2/.../FILE_NAME</code>. Alternatively you can create a BigQuery table and upload the data into the table. The URI for your table is <code>bq://PROJECT_ID.DATASET_ID.TABLE_ID</code>.</p>
<p>Importing data may take a few minutes or hours depending on the size of your data. If your Colab times out, run the following command to retrieve your dataset. Replace <code>dataset_name</code> with its actual value obtained in the preceding cells.</p>

<pre><code>dataset = client.get_dataset(dataset_name)</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title ... if data source is GCS { vertical-output: true }</span>

<span class="n">dataset_gcs_input_uris</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gs://&lt;BUCKET_NAME&gt;/&lt;FILE_PATH&gt;&#39;</span><span class="p">,]</span> <span class="c1">#@param</span>
<span class="c1"># Define input configuration.</span>
<span class="n">input_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gcs_source&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;input_uris&#39;</span><span class="p">:</span> <span class="n">dataset_gcs_input_uris</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title ... if data source is BigQuery { vertical-output: true }</span>

<span class="n">dataset_bq_input_uri</span> <span class="o">=</span> <span class="s1">&#39;bq://&lt;PROJECT_ID&gt;.&lt;DATASET_NAME&gt;.&lt;TABLE_NAME&gt;&#39;</span> <span class="c1">#@param {type: &#39;string&#39;}</span>
<span class="c1"># Define input configuration.</span>
<span class="n">input_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bigquery_source&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;input_uri&#39;</span><span class="p">:</span> <span class="n">dataset_bq_input_uri</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> <span class="c1">#@title Import data { vertical-output: true }</span>

<span class="n">import_data_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">,</span> <span class="n">input_config</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset import operation: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">import_data_response</span><span class="o">.</span><span class="n">operation</span><span class="p">))</span>
<span class="c1"># Wait until import is done.</span>
<span class="n">import_data_result</span> <span class="o">=</span> <span class="n">import_data_response</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">import_data_result</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Review-the-specs">Review the specs<a class="anchor-link" href="#Review-the-specs"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following command to see table specs such as row count.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Table schema { vertical-output: true }</span>

<span class="kn">import</span> <span class="nn">google.cloud.automl_v1beta1.proto.data_types_pb2</span> <span class="k">as</span> <span class="nn">data_types</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># List table specs</span>
<span class="n">list_table_specs_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_table_specs</span><span class="p">(</span><span class="n">dataset_name</span><span class="p">)</span>
<span class="n">table_specs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_table_specs_response</span><span class="p">]</span>
<span class="c1"># List column specs</span>
<span class="n">table_spec_name</span> <span class="o">=</span> <span class="n">table_specs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">list_column_specs_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">list_column_specs</span><span class="p">(</span><span class="n">table_spec_name</span><span class="p">)</span>
<span class="n">column_specs</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="o">.</span><span class="n">display_name</span><span class="p">:</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_column_specs_response</span><span class="p">}</span>
<span class="c1"># Table schema pie chart.</span>
<span class="n">type_counts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">column_spec</span> <span class="ow">in</span> <span class="n">column_specs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
  <span class="n">type_name</span> <span class="o">=</span> <span class="n">data_types</span><span class="o">.</span><span class="n">TypeCode</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="n">column_spec</span><span class="o">.</span><span class="n">data_type</span><span class="o">.</span><span class="n">type_code</span><span class="p">)</span>
  <span class="n">type_counts</span><span class="p">[</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">type_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">type_counts</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">labels</span><span class="o">=</span><span class="n">type_counts</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Run the following command to see column specs such inferred schema.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="4.-Update-dataset:-assign-a-label-column-and-enable-nullable-columns">4. Update dataset: assign a label column and enable nullable columns<a class="anchor-link" href="#4.-Update-dataset:-assign-a-label-column-and-enable-nullable-columns"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>AutoML Tables automatically detects your data column type. For example, for the <a href="https://storage.cloud.google.com/rostam-193618-tutorial/automl-tables-v1beta1/iris.csv">Iris dataset</a> it detects <code>species</code> to be categorical and <code>petal_length</code>, <code>petal_width</code>, <code>sepal_length</code>, and <code>sepal_width</code> to be numerical. Depending on the type of your label column, AutoML Tables chooses to run a classification or regression model. If your label column contains only numerical values, but they represent categories, change your label column type to categorical by updating your schema.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-a-column:-set-to-nullable">Update a column: set to nullable<a class="anchor-link" href="#Update-a-column:-set-to-nullable"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Update dataset { vertical-output: true }</span>

<span class="n">update_column_spec_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">column_specs</span><span class="p">[</span><span class="s1">&#39;sepal_length&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;type_code&#39;</span><span class="p">:</span> <span class="s1">&#39;FLOAT64&#39;</span><span class="p">,</span>
        <span class="s1">&#39;nullable&#39;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">update_column_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">update_column_spec</span><span class="p">(</span><span class="n">update_column_spec_dict</span><span class="p">)</span>
<span class="n">update_column_response</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Tip:</strong> You can use <code>'type_code': 'CATEGORY'</code> in the preceding <code>update_column_spec_dict</code> to convert the column data type from <code>FLOAT64</code> <code>to</code>CATEGORY`.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-dataset:-assign-a-label">Update dataset: assign a label<a class="anchor-link" href="#Update-dataset:-assign-a-label"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Update dataset { vertical-output: true }</span>

<span class="n">label_column_name</span> <span class="o">=</span> <span class="s1">&#39;species&#39;</span> <span class="c1">#@param {type: &#39;string&#39;}</span>
<span class="n">label_column_spec</span> <span class="o">=</span> <span class="n">column_specs</span><span class="p">[</span><span class="n">label_column_name</span><span class="p">]</span>
<span class="n">label_column_id</span> <span class="o">=</span> <span class="n">label_column_spec</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Label column ID: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label_column_id</span><span class="p">))</span>
<span class="c1"># Define the values of the fields to be updated.</span>
<span class="n">update_dataset_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">dataset_name</span><span class="p">,</span>
    <span class="s1">&#39;tables_dataset_metadata&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;target_column_spec_id&#39;</span><span class="p">:</span> <span class="n">label_column_id</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">update_dataset_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">update_dataset</span><span class="p">(</span><span class="n">update_dataset_dict</span><span class="p">)</span>
<span class="n">update_dataset_response</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="5.-Creating-a-model">5. Creating a model<a class="anchor-link" href="#5.-Creating-a-model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Train-a-model">Train a model<a class="anchor-link" href="#Train-a-model"> </a></h3><p>Specify the duration of the training. For example, <code>'train_budget_milli_node_hours': 1000</code> runs the training for one hour. If your Colab times out, use <code>client.list_models(location_path)</code> to check whether your model has been created. Then use model name to continue to the next steps. Run the following command to retrieve your model. Replace <code>model_name</code> with its actual value.</p>

<pre><code>model = client.get_model(model_name)</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Create model { vertical-output: true }</span>

<span class="n">model_display_name</span> <span class="o">=</span> <span class="s1">&#39;iris_model&#39;</span> <span class="c1">#@param {type:&#39;string&#39;}</span>

<span class="n">model_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="n">model_display_name</span><span class="p">,</span>
    <span class="s1">&#39;dataset_id&#39;</span><span class="p">:</span> <span class="n">dataset_name</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="s1">&#39;tables_model_metadata&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;train_budget_milli_node_hours&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}</span>
<span class="p">}</span>
<span class="n">create_model_response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_model</span><span class="p">(</span><span class="n">location_path</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataset import operation: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">create_model_response</span><span class="o">.</span><span class="n">operation</span><span class="p">))</span>
<span class="c1"># Wait until model training is done.</span>
<span class="n">create_model_result</span> <span class="o">=</span> <span class="n">create_model_response</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="n">create_model_result</span><span class="o">.</span><span class="n">name</span>
<span class="n">create_model_result</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="6.-Make-a-prediction">6. Make a prediction<a class="anchor-link" href="#6.-Make-a-prediction"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are two different prediction modes: online and batch. The following cell shows you how to make an online prediction.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Make an online prediction { vertical-output: true }</span>

<span class="n">sepal_length</span> <span class="o">=</span> <span class="mf">5.8</span> <span class="c1">#@param {type:&#39;slider&#39;, min:4, max:8, step:0.1}</span>
<span class="n">sepal_width</span> <span class="o">=</span> <span class="mf">3.1</span> <span class="c1">#@param {type:&#39;slider&#39;, min:2, max:5, step:0.1}</span>
<span class="n">petal_length</span> <span class="o">=</span> <span class="mf">3.8</span> <span class="c1">#@param {type:&#39;slider&#39;, min:1, max:7, step:0.1}</span>
<span class="n">petal_width</span> <span class="o">=</span> <span class="mf">1.2</span> <span class="c1">#@param {type:&#39;slider&#39;, min:0, max:3, step:0.1}</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;row&#39;</span><span class="p">:</span> <span class="p">{</span>       
        <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s1">&#39;number_value&#39;</span><span class="p">:</span> <span class="n">sepal_length</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;number_value&#39;</span><span class="p">:</span> <span class="n">sepal_width</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;number_value&#39;</span><span class="p">:</span> <span class="n">petal_length</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;number_value&#39;</span><span class="p">:</span> <span class="n">petal_width</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># Make a prediction.</span>
<span class="n">prediction_client</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="7.-Batch-prediction">7. Batch prediction<a class="anchor-link" href="#7.-Batch-prediction"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Initialize-prediction">Initialize prediction<a class="anchor-link" href="#Initialize-prediction"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Your data source for batch prediction can be GCS or BigQuery. For this tutorial, you can use <a href="https://storage.cloud.google.com/rostam-193618-tutorial/automl-tables-v1beta1/iris_batch_prediction_input.csv">iris_batch_prediction_input.csv</a> as input source. Create a GCS bucket and upload the file into your bucket. Some of the lines in the batch prediction input file are intentionally left missing some values. The AutoML Tables logs the errors in the <code>errors.csv</code> file.</p>
<p><strong>NOTE:</strong> The client library has a bug. If the following cell returns a <code>TypeError: Could not convert Any to BatchPredictResult</code> error, ignore it. The batch prediction output file(s) will be updated to the GCS bucket that you set in the preceding cells.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#@title Start batch prediction { vertical-output: true, output-height: 200 }</span>

<span class="n">batch_predict_gcs_input_uris</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gs://automl-tables-data/iris_batch_prediction_input.csv&#39;</span><span class="p">,]</span> <span class="c1">#@param</span>
<span class="n">batch_predict_gcs_output_uri_prefix</span> <span class="o">=</span> <span class="s1">&#39;gs://automl-tables-pred&#39;</span> <span class="c1">#@param {type:&#39;string&#39;}</span>
<span class="c1"># Define input source.</span>
<span class="n">batch_prediction_input_source</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;gcs_source&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;input_uris&#39;</span><span class="p">:</span> <span class="n">batch_predict_gcs_input_uris</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># Define output target.</span>
<span class="n">batch_prediction_output_target</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gcs_destination&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;output_uri_prefix&#39;</span><span class="p">:</span> <span class="n">batch_predict_gcs_output_uri_prefix</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">batch_predict_response</span> <span class="o">=</span> <span class="n">prediction_client</span><span class="o">.</span><span class="n">batch_predict</span><span class="p">(</span>
    <span class="n">model_name</span><span class="p">,</span> <span class="n">batch_prediction_input_source</span><span class="p">,</span> <span class="n">batch_prediction_output_target</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Batch prediction operation: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">batch_predict_response</span><span class="o">.</span><span class="n">operation</span><span class="p">))</span>
<span class="c1"># Wait until batch prediction is done.</span>
<span class="n">batch_predict_result</span> <span class="o">=</span> <span class="n">batch_predict_response</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
<span class="n">batch_predict_response</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">batch_predict_response</span><span class="o">.</span><span class="n">metadata</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

